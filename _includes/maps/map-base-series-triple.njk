<md-raw>
<script type="text/javascript" src="/assets/lib/leaflet-1.9.3.min.js" defer></script>
<script type="text/javascript" src="/assets/lib/tile.stamen-1.3.0.js" defer></script>
<script type="text/javascript" src="/assets/lib/leaflet.curve-0.9.1.min.js" defer></script>
<script type="text/javascript" src="/assets/lib/anime-3.2.1.min.js" defer></script>

{% block setupScript %}{% endblock %}

<script src="/assets/js/maps-common.js" defer></script>

{# Getting series data #}
{% set sortAttr = ("title" if "garage" in tags else "seriesOrder") %}
{% set seriesPostDatas = collections.all | attr("data") | selectAttrEquals("series", series) | sort(false, false, sortAttr) %}

{# standard wrapperClasses are "map-bg" #}
<div class="full-width cb flex flex-wrap flex-nowrap-ns justify-center pv4 pv5-l {% block wrapperClasses %}{% endblock %}">
    {# Col 1: Series #}
    <div class="ph3 w-100 w-third-ns normal-links sans-serif flex justify-left justify-center-ns self-center">
        <div class="pl4 pl0-ns">
            <p class="b ttu tracked lh-solid mt1 mb2 mb3-l f4 dib">{{ series }}</p>
            {% set colClass = "doublecol-ns" if seriesPostDatas | length >= 10 else "" %}
            <ol class="ma0 f5 {{ colClass }} pl0">
                {% for seriesPostData in seriesPostDatas %}
                    <li class="ml4">
                        {% if seriesPostData.title == title %}
                            <span class="b db pt1">
                                {{ seriesPostData.title }}
                            </span>
                        {% else %}
                            <a href="{{ seriesPostData.page.url }}" class="db pt1">
                                {{ seriesPostData.title }}
                            </a>
                        {% endif %}
                    </li>
                {% endfor %}
            </ol>
        </div>
    </div>

    {# Col 2: Context map #}
    <div class="mv4 mv0-ns ph3 w-100 w-third-ns">
        <div class="relative">
            <div id="mapContext" class="leafletMap bg-white mapSmall center shadow-1">
                <img src="{% block contextPreview %}{% endblock %}" class="novmargin" />
            </div>
            {% block contextOverlay %}{% endblock %}
        </div>
    </div>

    {# Col 3: Trip map #}
    <div class="ph3 w-100 w-third-ns">
        <div id="mapTrip" class="leafletMap bg-white mapSmall center shadow-1">
            <img src="{% block tripPreview %}{% endblock %}" class="novmargin" />
        </div>
    </div>
</div>
</md-raw>
