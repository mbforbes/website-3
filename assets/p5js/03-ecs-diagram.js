(()=>{"use strict";var t={937:function(t,e,s){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(s(657)),h=s(428),o=s(260);let r=1;function a(t){return(Math.random()<.5?-1:1)*(t[0]+Math.random()*(t[1]-t[0]))}class p extends o.Component{}class d extends o.Component{constructor(t){super(),this.p=t,this.d=100,this.target=new h.Vector2(-1,-1)}}class l extends o.Component{constructor(){super(...arguments),this.d=30,this.phaseCur=0}get offset(){return Math.sin(this.phaseCur/this.phaseDuration*Math.PI*2)}get inFront(){let t=this.phaseCur/this.phaseDuration;return t<.25||t>.75}}class c extends l{constructor(){super(...arguments),this.color="#D23A5B",this.phaseDuration=3e3,this.theta_rad=-Math.PI/4}}class u extends l{constructor(){super(...arguments),this.color="#476FDE",this.phaseDuration=2e3,this.theta_rad=Math.PI/7}}class y extends l{constructor(){super(...arguments),this.color="#F4A825",this.phaseDuration=1800,this.theta_rad=Math.PI/1}}class m extends l{constructor(){super(...arguments),this.color="#C06BBC",this.phaseDuration=4e3,this.theta_rad=Math.PI/2}}class f extends l{constructor(){super(...arguments),this.color="#32864B",this.phaseDuration=3500,this.theta_rad=Math.PI/3}}class x extends o.System{constructor(t,e,s){super(),this.p5i=t,this.width=e,this.yBounds=s,this.highlightColor="#E4DF57",this.txtColor="#242424",this.leftBuffer=10,this.referenceComponents=new Array}init(){for(let t of this.componentsRequired)t!=d&&this.referenceComponents.push(new t)}mouseOver(t,e){return t>0&&t<this.width&&e>this.yBounds.x&&e<this.yBounds.y}update(t,e){let s=this.p5i.mouseX/r,i=this.p5i.mouseY/r;if(this.mouseOver(s,i)){this.ecs.getSystem(S).targetComps=new Set(this.componentsRequired),this.p5i.fill(this.highlightColor),this.p5i.rect(0,this.yBounds.x,this.width,this.yBounds.y-this.yBounds.x);const e=30;let s=340;for(let i of t.values()){let t=i.get(d);t.target.set(s,(this.yBounds.x+this.yBounds.y)/2),s+=t.d+e}}this.p5i.fill(this.txtColor),this.p5i.textStyle(this.p5i.NORMAL),this.p5i.textSize(16),this.p5i.textAlign(this.p5i.LEFT,this.p5i.BOTTOM),this.p5i.text("SYSTEM",this.leftBuffer,(this.yBounds.x+this.yBounds.y)/2-34),this.p5i.textStyle(this.p5i.NORMAL),this.p5i.textSize(60),this.p5i.textAlign(this.p5i.LEFT,this.p5i.BOTTOM),this.p5i.text(this.sysName,this.leftBuffer,(this.yBounds.x+this.yBounds.y)/2+24),this.p5i.textStyle(this.p5i.NORMAL),this.p5i.textSize(18),this.p5i.textAlign(this.p5i.LEFT,this.p5i.TOP);let n="Physics"!=this.sysName?"requires components":"requires      components";this.p5i.text(n,this.leftBuffer,(this.yBounds.x+this.yBounds.y)/2+14);let h=this.leftBuffer+10;for(let t of this.referenceComponents)this.p5i.fill(t.color),this.p5i.circle(h,(this.yBounds.x+this.yBounds.y)/2+44,20),h+=23}}class w extends x{constructor(t,e,s){super(t,e,s),this.componentsRequired=new Set([d,c,u]),this.sysName="Animator",this.init()}}class C extends x{constructor(t,e,s){super(t,e,s),this.componentsRequired=new Set([d,y]),this.sysName="Physics",this.init()}}class g extends x{constructor(t,e,s){super(t,e,s),this.componentsRequired=new Set([d,u,f]),this.sysName="Renderer",this.init()}}class S extends o.System{constructor(t){super(),this.p5i=t,this.colorFG="#BABABA",this.colorBG="#373737",this.compsToDraw=[c,u,y,m,f],this.targetComps=new Set,this.componentsRequired=new Set([d])}drawC(t,e,s){let i=0==s.size||s.has(e.constructor);this.p5i.fill(e.color+(i?"FF":"22"));let n=Math.sin(e.theta_rad),o=Math.cos(e.theta_rad),r=new h.Vector2(n,o).multiplyScalar(e.offset*(t.d/2+e.d/2+20));this.p5i.circle(t.p.x+r.x,t.p.y+r.y,e.d)}update(t,e){let s=!1;for(let[e,i]of t.entries()){let t=i.get(d);if(-1!=t.target.x&&-1!=t.target.y){s=!0;break}}for(let[e,s]of t.entries()){let t=s.get(d);for(let e of this.compsToDraw){if(!s.has(e))continue;let i=s.get(e);i.phaseCur=(i.phaseCur+16.6)%i.phaseDuration,i.inFront&&this.drawC(t,i,this.targetComps)}}for(let[e,i]of t.entries()){let t=i.get(d),n=s&&-1==t.target.x&&-1==t.target.y;this.p5i.noStroke(),this.p5i.fill(this.colorBG+(n?"22":"FF")),this.p5i.circle(t.p.x,t.p.y,t.d),this.p5i.fill(this.colorFG+(n?"22":"FF")),this.p5i.textAlign(this.p5i.CENTER,this.p5i.CENTER),this.p5i.textSize(60),this.p5i.textStyle(this.p5i.BOLD),this.p5i.text(""+(e+1),t.p.x,t.p.y),this.p5i.textSize(14),this.p5i.textStyle(this.p5i.NORMAL),this.p5i.text("ENTITY",t.p.x,t.p.y+30);for(let e of this.compsToDraw){if(!i.has(e))continue;let s=i.get(e);s.inFront||this.drawC(t,s,this.targetComps)}}this.targetComps.clear()}}class E extends o.Aspect{constructor(){super(),this.vStartRange=[1,3],this.v=new h.Vector2(a(this.vStartRange),a(this.vStartRange)),this.prevTarget=this.v.clone()}}class v extends o.System{constructor(t){super(),this.bounds=t,this.componentsRequired=new Set([d])}makeAspect(){return new E}update(t,e){for(let[e,s]of t.entries()){let i=s.get(d);if(-1!=i.target.x&&-1!=i.target.y)s.v=i.target.clone().sub(i.p).multiplyScalar(.1);else if(-1!=s.prevTarget.x&&-1!=s.prevTarget.y){let t=a(s.vStartRange),e=a(s.vStartRange);s.v.set(t,e)}s.prevTarget.copy(i.target),i.target.set(-1,-1),i.p.add(s.v),(i.p.x+i.d/2>this.bounds.x||i.p.x-i.d/2<0)&&s.v.setX(-s.v.x),(i.p.y+i.d/2>this.bounds.y||i.p.y-i.d/2<0)&&s.v.setY(-s.v.y);for(let[n,h]of t.entries()){if(e==n)continue;let t=h.get(d);if(i.p.distanceTo(t.p)<=.5*(i.d+t.d)){let e=s.v.length();s.v.copy(t.p.clone().sub(i.p).normalize().multiplyScalar(-e))}}}}}class B extends o.System{constructor(t,e){super(),this.p5i=t,this.baseDims=e,this.componentsRequired=new Set([p]),this.buf=20,this.addClicked=!1,this.removeClicked=!1,this.y1=this.buf,this.h1=75,this.x1=this.baseDims.x-this.buf-200,this.w1=200,this.x2=this.baseDims.x-this.buf-200,this.y2=this.y1+this.h1+this.buf,this.w2=200,this.h2=75}contains(t,e,s,i,n,h){return t>s&&t<s+n&&e>i&&e<i+h}onClick(){let t=this.p5i.mouseX/r,e=this.p5i.mouseY/r;this.addClicked=this.contains(t,e,this.x1,this.y1,this.w1,this.h1),this.removeClicked=this.contains(t,e,this.x2,this.y2,this.w2,this.h2)}update(t,e){let s=this.p5i.mouseX/r,i=this.p5i.mouseY/r;if(this.p5i.textStyle(this.p5i.BOLD),this.contains(s,i,this.x1,this.y1,this.w1,this.h1))if(this.addClicked){this.p5i.fill("#D23A5B");let t=this.ecs.addEntity();this.ecs.addComponent(t,new d(new h.Vector2(Math.random()*this.baseDims.x,Math.random()*this.baseDims.y)));for(let e of[c,u,y,m,f])Math.random()>.5&&this.ecs.addComponent(t,new e)}else this.p5i.fill("#E4DF57");else this.p5i.noFill();this.p5i.stroke(24),this.p5i.strokeWeight(3),this.p5i.rect(this.x1,this.y1,this.w1,this.h1,4,4,4,4),this.p5i.textAlign(this.p5i.CENTER,this.p5i.CENTER),this.p5i.textSize(24),this.p5i.fill(24),this.p5i.noStroke(),this.p5i.text("add entity",this.x1+this.w1/2,this.y1+this.h1/2),this.contains(s,i,this.x2,this.y2,this.w2,this.h2)?this.removeClicked?(this.p5i.fill("#D23A5B"),this.ecs.removeRandomEntity()):this.p5i.fill("#E4DF57"):this.p5i.noFill(),this.p5i.stroke(24),this.p5i.strokeWeight(3),this.p5i.rect(this.x2,this.y2,this.w2,this.h2,4,4,4,4),this.p5i.textAlign(this.p5i.CENTER,this.p5i.CENTER),this.p5i.textSize(24),this.p5i.fill(24),this.p5i.noStroke(),this.p5i.text("remove entity",this.x2+this.w2/2,this.y2+this.h2/2),this.addClicked=!1,this.removeClicked=!1}}new n.default((t=>{const e=new h.Vector2(1024,775),s=e.x/e.y;let i=new h.Vector2;const n=new o.ECS;let a;t.setup=()=>{i.copy(e),t.createCanvas(...i.toArray()).parent("parent"),t.windowResized(),n.addSystem(new w(t,e.x,new h.Vector2(400,525))),n.addSystem(new C(t,e.x,new h.Vector2(525,650))),n.addSystem(new g(t,e.x,new h.Vector2(650,775))),n.addSystem(new S(t)),n.addSystem(new v(e)),a=new B(t,e),n.addSystem(a);let s=n.addEntity();n.addComponent(s,new d(new h.Vector2(800,100))),n.addComponent(s,new c),n.addComponent(s,new u);let o=n.addEntity();n.addComponent(o,new d(new h.Vector2(200,100))),n.addComponent(o,new c),n.addComponent(o,new u),n.addComponent(o,new f);let r=n.addEntity();n.addComponent(r,new d(new h.Vector2(200,100))),n.addComponent(r,new c),n.addComponent(r,new u),n.addComponent(r,new y),n.addComponent(r,new m),n.addComponent(r,new f)},t.mouseClicked=t=>{a&&a.onClick()},t.draw=()=>{t.clear(),t.background("#FFF"),r=i.x/e.x,t.scale(r),n.update()},t.windowResized=()=>{let n=function(t,e=".markdown-body"){let s=t.windowWidth,i=document.querySelector(e);return null!=i&&(s=Math.min(s,i.clientWidth)),s-15}(t);n<e.x?i.set(n,Math.round(n/s)):i.copy(e),t.resizeCanvas(...i.toArray())}}))},260:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ECS=e.Aspect=e.System=e.Component=void 0,e.Component=class{constructor(){this.signal=()=>{}}dirty(){this.signal()}},e.System=class{constructor(){this.dirtyComponents=new Set}makeAspect(){return new i}onAdd(t){}onRemove(t){}};class s{constructor(){this.map=new Map}add(t){this.map.set(t.constructor,t)}get(t){return this.map.get(t)}has(t){return this.map.has(t)}hasAll(t){for(let e of t)if(!this.map.has(e))return!1;return!0}delete(t){this.map.delete(t)}}class i{setCC(t){this.components=t}get(t){return this.components.get(t)}has(...t){for(let e of t)if(!this.components.has(e))return!1;return!0}}e.Aspect=i,e.ECS=class{constructor(){this.entities=new Map,this.systems=new Map,this.nextEntityID=0,this.entitiesToDestroy=new Array,this.dirtySystemsCare=new Map,this.dirtyEntities=new Map}addEntity(){let t=this.nextEntityID;return this.nextEntityID++,this.entities.set(t,new s),t}removeEntity(t){this.entitiesToDestroy.push(t)}removeRandomEntity(){let t=Array.from(this.entities.keys()),e=t[Math.floor(Math.random()*t.length)];return this.removeEntity(e),e}addComponent(t,e){this.entities.get(t).add(e),e.signal=()=>{this.componentDirty(t,e)},this.checkE(t),e.signal()}getComponents(t){return this.entities.get(t)}removeComponent(t,e){this.entities.get(t).delete(e),this.checkE(t)}addSystem(t){if(0==t.componentsRequired.size)return console.warn("System not added: empty Components list."),void console.warn(t);t.ecs=this,this.systems.set(t,new Map);for(let e of this.entities.keys())this.checkES(e,t);for(let e of t.dirtyComponents)this.dirtySystemsCare.has(e)||this.dirtySystemsCare.set(e,new Set),this.dirtySystemsCare.get(e).add(t);this.dirtyEntities.set(t,new Set)}getSystem(t){for(let e of this.systems.keys())if(e.constructor==t)return e;return null}update(){for(let[t,e]of this.systems.entries())t.update(e,this.dirtyEntities.get(t)),this.dirtyEntities.get(t).clear();for(;this.entitiesToDestroy.length>0;)this.destroyEntity(this.entitiesToDestroy.pop())}destroyEntity(t){this.entities.delete(t);for(let[e,s]of this.systems.entries()){if(s.has(t)){let i=s.get(t);s.delete(t),e.onRemove(i)}this.dirtyEntities.has(e)&&this.dirtyEntities.get(e).delete(t)}}checkE(t){for(let e of this.systems.keys())this.checkES(t,e)}checkES(t,e){let s=this.entities.get(t),i=e.componentsRequired,n=this.systems.get(e);if(s.hasAll(i)){if(!n.has(t)){let i=e.makeAspect();i.entity=t,i.setCC(s),n.set(t,i),e.onAdd(i)}}else n.delete(t)}componentDirty(t,e){if(this.dirtySystemsCare.has(e.constructor))for(let s of this.dirtySystemsCare.get(e.constructor))this.systems.get(s).has(t)&&this.dirtyEntities.get(s).add(t)}}},428:t=>{t.exports=THREE},657:t=>{t.exports=p5}},e={};!function s(i){var n=e[i];if(void 0!==n)return n.exports;var h=e[i]={exports:{}};return t[i].call(h.exports,h,h.exports,s),h.exports}(937)})();