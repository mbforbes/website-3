<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Does k-means on an image&#39;s colors make a good palette? - Maxwell Forbes</title>
        <!-- NOTE: Twitter uses name='', og uses property='' -->
        <meta content="Does k-means on an image&#39;s colors make a good palette? - Maxwell Forbes" property="title"/>
        <meta content="Does k-means on an image&#39;s colors make a good palette? - Maxwell Forbes" property="og:title"/>
        <meta name="twitter:title" content="Does k-means on an image&#39;s colors make a good palette? - Maxwell Forbes"/>

        <link href='/website-3/assets/img/fav.png' rel='shortcut icon'>
<link href='/website-3/assets/css/tachyons.min.css' rel='stylesheet' type='text/css'/>
<link href='/website-3/assets/css/style.css' rel='stylesheet' type='text/css'/>
<link href='/website-3/assets/css/syntax/prism.default.css' rel='stylesheet' type='text/css'/>

<!-- NOTE: Twitter uses name='', og uses property='' -->

    <meta content='https://maxwellforbes.com/garage/does-k-means-on-an-images-colors-make-a-good-palette/' property='og:url'/>
    
        <meta content='/website-3/assets/garage/k-means-colors/example.hsv.palette-1-36.png' property='og:image'/>
        <meta name='twitter:image' content='/website-3/assets/garage/k-means-colors/example.hsv.palette-1-36.png'/>
        <meta name='twitter:card' content='summary_large_image'/>
    
    <meta name='twitter:site' content='@maxforbes'/>
    
        <meta content="" property='og:description'/>
        <meta name='twitter:description' content=""/>
    
    <meta content="article" property="og:type"/>

<!-- - -->



    </head>

    <body class="lh-copy near-black pa0 f5 f4-ns sans-serif">
        

  <div class="mw7 mt3 mt4-ns mb3 center">

    <nav class="mh3 mh4-ns pv3 flex" aria-label="Main">
      <div class="w-50 tl">
        <!-- Note: originally used https://maxwellforbes.com changed for href-looking CSS that adds
          the up arrow. Change back (this & other internal links) if no longer on root domain. -->
        <a href="/" class="hover dim black" id="header">Maxwell Forbes</a>
      </div>
      <div class="w-50 tr">
        
          <!-- If you're on that page, don't show as a link. -->
          
            <a class="link hover-mid-gray ml3 pv1" href="/website-3/studio">
              Studio
            </a>
          
        
          <!-- If you're on that page, don't show as a link. -->
          
            <a class="link hover-mid-gray ml3 pv1" href="/website-3/research">
              Research
            </a>
          
        
      </div>
    </nav>

    <div class="mh3 mh4-ns bt b--black-80"></div>

    <main class="tl relative ph3 ph4-ns pt4 pb2 paddingOverride">
      
        <div class="mb4">
          <!-- Date -->
          
            <div class="fw600 light-silver mt1 ttu">
              
                <a href="/website-3/studio#garage" class="light-silver hover-blue">GARAGE/</a>
              
            </div>
          

          <!-- Title -->
          <h1 class="ttu tracked f3 f2-ns mt0 lh-title cb mb2">
            <!-- Kind of a hack for page title in a series of posts (e.g., sparking joy w/ python) -->
            
              Does k-means on an image&#39;s colors make a good palette?
            
          </h1>
          

        </div>
      

      <!-- Series header. -->
      

      <div class="markdown-body">
        <p>I was trying to come up with a color palette for an illustration, and I came across this image:</p>
<p><img src="/website-3/assets/garage/k-means-colors/inspiration.jpg" alt="bird flying with associated color palette"></p>
<p class="figcaption">
<a href="https://www.printmag.com/post/50-best-color-sites-graphic-designers">
source
</a>
</p>
<p>For whatever reason, this made me wonder: how do people extract color palettes from images? Can we do this automatically?</p>
<p>Could it perhaps be that, if we simply run k-means on the RGB colors of each pixel, we’ll recover the palette?</p>
<p>Rather than Google for the answer, I was struck by a desire to rekindle my <a href="/website-3/garage/spirit-of-discovery/">spirit of discovery</a> and find out for myself.</p>
<h2>k-means, RGB</h2>
<p>Running k-means on the RGB colors of the image with <code>k = 7</code>, I came up with:</p>
<p><img src="/website-3/assets/garage/k-means-colors/example.rgb.palette-7.png" alt="7-color palette"></p>
<p class="figcaption">k-means on RGB pixels, <code>k = 7</code></p>
<p>Hmm, definitely missing some of the colors we’d like, at least a red and a green.</p>
<p>I tried with different values of <code>k</code>. Here’s 1 through 12:</p>
<p><img src="/website-3/assets/garage/k-means-colors/example.rgb.palette-1-12.png" alt="7-color palette"></p>
<p class="figcaption">k-means on RGB pixels, <code>k ∈ {1 ... 12}</code></p>
<p>The k-means implementation I’m using is pretty stable (I think the initialization may use a deterministic heuristic). We can notice that by:</p>
<ul>
<li><code>k = 7</code>, we get a nicer blue</li>
<li><code>k = 8</code>, the yellow/green splits into lighter and darker greens</li>
<li><code>k = 10</code>, we finally get a red</li>
</ul>
<blockquote>
<p>Aside: I sorted the colors in the display of these palettes using HSV so they’re easier to compare. It turns out <a href="https://www.alanzucconi.com/2015/09/30/colour-sorting/">sorting colors is challenging</a> in its own right! You can already tell this by the inconsistencies in ordering the darker greens (bottom three) and grays (throughout).</p>
</blockquote>
<p>So the answer seems to be: no, it’s not quite as simple as running k-means on the RGB colors. My hunch is that RGB is a bad way of featurizing the colors. My guess is that what we are looking for in a palette—distinct, strong colors—is not reflected in perceptual RGB distances.</p>
<h2>k-means, HSV</h2>
<p>Just as I finished writing the above, and was considering Googling how people do this, I realized I’d missed a totally obvious connection.</p>
<p>I had run k-means on the pixels in RGB color space. But I had then sorted the output palette using a different color space: HSV. What if we ran k-means on the pixels in HSV?</p>
<p><img src="/website-3/assets/garage/k-means-colors/reference.palette.jpg" alt="">
<img src="/website-3/assets/garage/k-means-colors/example.rgb.palette-7.png" alt="">
<img src="/website-3/assets/garage/k-means-colors/example.hsv.palette-7.png" alt=""></p>
<p class="figcaption" markdown="1">
<span class="b">Top:</span>
reference.
<span class="b">Middle:</span>
RGB k-means.
<span class="b">Bottom:</span>
HSV k-means.
</p>
<p>HSV shows minor changes from RGB: just the first three colors.</p>
<p>Here’s k-means on HSV for several <code>k</code> values:</p>
<p><img src="/website-3/assets/garage/k-means-colors/example.hsv.palette-1-12.png" alt=""></p>
<p class="figcaption">k-means on HSV pixels, <code>k ∈ {1 ... 12}</code></p>
<p>Very interesting! We see a brighter green than ever appears in the RGB clusters, but only for <code>k ∈ {3, 4}</code>. A second blue appears for <code>k = 12</code>. And, no red so far.</p>
<p>Just for fun, I tried running it up to <code>k = 36</code> to see what would happen.</p>
<p><img src="/website-3/assets/garage/k-means-colors/example.hsv.palette-1-36.png" alt=""></p>
<p class="figcaption">k-means on HSV pixels, <code>k ∈ {1 ... 36}</code></p>
<p>Looks like red was just around the corner. It’s a shame we never get that brilliant green back. I still think we can do better than this, but cranking <code>k</code> way up like this would reveal one computer/human hybrid approach: the computer over-generates a large palette, then the human samples from it to make a smaller one.</p>
<h2>Wrapping up</h2>
<p>I’ve got to stop working on this now and get back to my other <a href="/website-3/garage/summer-2021-website-goals/">summer goals</a>. If you’re curious, here’s my code:</p>
<style>
    .black-and-white:not(:hover) {
        filter: grayscale(100%);
    }
</style>
<link href='/website-3/assets/css/tippy-6.3.1.light.css' rel="stylesheet" type="text/css"/>
<script defer src='/website-3/assets/lib/popper-2.9.3.min.js'></script>
<script defer src='/website-3/assets/lib/tippy-6.3.1.umd.min.js'></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const langs = [
            'Python',
            'TypeScript',
            'Bash',
            'Java',
            'HTML',
            'JavaScript',
            'Ruby',
            'PHP'
        ];
        for (let lang of langs) {
            let lower = lang.toLowerCase();
            tippy(`.${lower}`, {
                content: `Written in ${lang}`,
                theme: 'light'
            });
        }
    });
</script>
<div class="pl3 bl bw1 mb4">
    <a href="https://github.com/mbforbes/k-means-colors" class="f5 f4-ns b code">k-means-colors</a><span class="dib fr">
            <img
                class="h1 black-and-white python"
                src="/website-3/assets/img/langs/python.svg"/>
        </span><p class="mv1 f5 f4-ns">Does k-means on an image&#39;s colors make a good palette?</p></div>
<p>As a final thought, I was wondering whether different color spaces are linear transformations of each other, and whether k-means or the algorithm I’m using is agnostic to linear transformations. Keeping the spirit of flying fast and loose, I haven’t looked either up, but if I were to keep going, these facts would inform what approach I take next. I wonder whether there is a color embedding that would make k-means find perceptually good color palettes?</p>

      </div>

      <!-- Series footer. -->
      

      <!-- Email box. -->
      <!-- <hr /> -->
<!-- <div class="bt b--black-80 mt4"></div> -->
<div class="ba b--black-80 mt5 f6 f5-ns">
    <form style="text-align:center;" action="https://tinyletter.com/mbforbes" method="post" target="popupwindow"
        onsubmit="window.open('https://tinyletter.com/mbforbes', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
        <p class="tc b">
            Monthly project and essay digest
        </p>
        <p class="tc measure center">
            <label for="tlemail">
                I send a summary every month of my new projects and essays.
                No spam, just me, Max. Unsub whenever.
            </label>
        </p>
        <p class="mb1">
            <input type="text" style="width:200px" name="email" id="tlemail" placeholder="your email"/>
            <input type="hidden" value="1" name="embed"/><input type="submit" value="Get on the list"/>
        </p>
        <p class="mt0 f7 f6-ns">
            <!-- via -->
            <img src='/website-3/assets/img/TinyLetter_Wordmark.png' style="height: 22px;"/>
        </p>
    </form>
</div>


      <!-- Garage footer. -->
      
        <p class="tr ttu black-30 fw6 f6 f5-ns mt5 mb0">garage entry metadata</p>
<table class="mv0 collapse ba br2 b--black-10 pv2 ph3 f6 f5-ns black-50 w-100">
    <tbody id="garage-metadata">
        <tr class="striped--near-white">
            <td class="pv2 ph3 ttu fw6">
                started
            </td>
            <td class="pv2 ph3 ttu">
                22 Aug 2021
            </td>
        </tr>

        

        <tr class="striped--near-white">
            <td class="pv2 ph3 ttu fw6">
                disclaimer
            </td>
            <td class="pv2 ph3">
                This is an entry in
                
                    <a href="/website-3/garage/what-is-the-garage/" class="hover-dark-blue underline-hover">the garage</a>.
                
                It may change or disappear at any point.
            </td>
        </tr>
    </tbody>
</table>

<!-- Comments! -->
<script src="https://utteranc.es/client.js" repo="mbforbes/website-comments" issue-term="pathname" theme="github-light"
    crossorigin="anonymous" async>
    </script>

<!-- Link graph! -->
<script async>
    function addRow(name, graph, keys) {
        let links = [];
        for (let key of keys) {
            if (!(key in graph)) {
                console.warn("Skipping " + key + ", not found in link graph.")
                continue;
            }
            
            links.push(`<li><a href="${graph[key].url}" class="hover-dark-blue underline-hover">${graph[key].title}<a/></li>`);
        }
        if (links.length == 0) {
            return;
        }
        let row = document.createElement("tr");
        row.classList.add("striped--near-white");
        row.innerHTML = `
        <tr class="striped--light-gray">
            <td class="pv2 ph3 ttu fw6">
                ${name}
            </td>
            <td class="pv2 ph3 ${name}">
                <ul class="pl3 mv0">
                    ${links.join("\n")}
                </ul>
            </td>
        </tr>
        `
        document.getElementById("garage-metadata").appendChild(row);
    }

    async function renderLinks() {
        let resp = await fetch("/website-3/assets/garage/link_graph.json");
        if (!resp.ok) {
            return;
        }
        let graph = await resp.json();
        let current = "/garage/does-k-means-on-an-images-colors-make-a-good-palette/";
        if (!(current in graph)) {
            return;
        }
        addRow("inbound", graph, graph[current].incoming);
        addRow("outbound", graph, graph[current].outgoing);

    }
    renderLinks();
</script>

      
    </main>
  </div>
  <footer class="mt5 f6 f5-ns mw7 center tc pt2 pb4 silver">
    <div class="mh3 mh4-ns bt b--silver mb1"></div>
    <a href="/about" class="link silver hover-blue pv1">
      about me
    </a>
    | orig theme is
    <a href="http://github.com/muan/scribble" class="link silver hover-blue pv1">Scribble</a>
    <!-- <img src="https://maxwellforbes.com/data/img/scribble2.png" alt="scribble" class="mt4 db center" /> -->
  </footer>

  <!-- The wave -->
  <script>
    // settings
    let periods = 0.5;
    let baseDelay = 1; // s
    let charDelay = 0.1; // s
    let duration = 0.70; // s
    let startW = 400; // w
    let mag = 400; // +/- w
    let refresh = 0.016667; // s

    // computed vals
    let frames = duration / refresh;

    // state
    let updaters = [];
    let frameNs = [];

    function fontWeighter(idx) {
      frameNs[idx] += 1;
      let x = (frameNs[idx] / frames) * periods * 2 * Math.PI;
      let w = Math.round(startW + mag * Math.sin(x));
      document
        .getElementById("header")
        .children[idx]
        .style
        .fontWeight = w;
      if (frameNs[idx] >= frames) {
        clearInterval(updaters[idx]);
      }
    }

    function wave() {
      // replace the string w/ elements. i write it as a string to start because i
      // couldn't get vscode's html formatter (using one for nunjucks) to not split
      // span elements each onto their own lines, which caused spaces between each
      // letter.
      let header = document.getElementById("header");
      let name = header.innerText;
      let els = [];
      for (let i = 0; i < name.length; i++) {
        let el = document.createElement("span");
        el.innerText = name[i];
        els.push(el);
      }
      header.innerText = '';
      header.append(...els);

      for (let i = 0; i < els.length; i++) {
        frameNs.push(0);
        setTimeout(() => {
          updaters.push(setInterval(fontWeighter.bind(null, i), refresh * 1000));
        }, (baseDelay + charDelay * i) * 1000);
      }
    }

    wave();
  </script>


    </body>

</html>
