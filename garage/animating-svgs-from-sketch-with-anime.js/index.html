<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Animating SVGs from Sketch with anime.js - Maxwell Forbes</title>
        
        <meta content="Animating SVGs from Sketch with anime.js - Maxwell Forbes" property="title"/>
        <meta content="Animating SVGs from Sketch with anime.js - Maxwell Forbes" property="og:title"/>
        <meta name="twitter:title" content="Animating SVGs from Sketch with anime.js - Maxwell Forbes"/>

        <link href='/website-3/assets/img/fav.png' rel='shortcut icon'>
<link href='/website-3/assets/css/tachyons.min.css' rel='stylesheet' type='text/css'/>
<link href='/website-3/assets/css/style.css' rel='stylesheet' type='text/css'/>
<link href='/website-3/assets/css/syntax/prism.default.css' rel='stylesheet' type='text/css'/>



    
    <meta content='https://maxwellforbes.com/garage/animating-svgs-from-sketch-with-anime.js/' property='og:url'/>
    
    <meta name='twitter:site' content='@maxforbes'/>
    
        
        <meta content="Animating SVGs is great, it makes posts more lively. Animating SVGs, at least in the pipeline I’m using (Sketch and..." property='og:description'/>
        <meta name='twitter:description' content="Animating SVGs is great, it makes posts more lively. Animating SVGs, at least in the pipeline I’m using (Sketch and..."/>
    
    <meta content="article" property="og:type"/>




    </head>

    <body class="lh-copy near-black pa0 f5 f4-ns sans-serif">
        

  <div class="mw7 mt3 mt4-ns mb3 center">

    <nav class="mh3 mh4-ns pv3 flex" aria-label="Main">
      <div class="w-50 tl">
        <a href="/website-3/" class="hover dim black" id="header">Maxwell Forbes</a>
      </div>
      <div class="w-50 tr">
        
          
          
            <a class="link hover-mid-gray ml3 pv1" href="/website-3/studio">
              Studio
            </a>
          
        
          
          
            <a class="link hover-mid-gray ml3 pv1" href="/website-3/research">
              Research
            </a>
          
        
      </div>
    </nav>

    <div class="mh3 mh4-ns bt b--black-80"></div>

    <main class="tl relative ph3 ph4-ns pt4 pb2 paddingOverride">
      
        <div class="mb4">
          
          
            <div class="fw600 light-silver mt1 ttu">
              
                <a href="/website-3/studio/#garage" class="light-silver hover-blue">GARAGE/</a>
              
            </div>
          

          
          <h1 class="ttu tracked f3 f2-ns mt0 lh-title cb mb2">
              Animating SVGs from Sketch with anime.js
          </h1>
          

        </div>
      

      
      

      <div class="markdown-body">
        <p>Animating SVGs is great, it makes <a href="/website-3/posts/every-phd-is-different/">posts more lively</a>.</p>
<p>Animating SVGs, at least in the pipeline I’m using (Sketch and anime.js), is also stupidly difficult for obscure reasons. I am going to try to document and improve my process.<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p>
<p><strong>Contents</strong></p>
<ol>
<li><a href="#sketch">Exporting from Sketch</a></li>
<li><a href="#embedding">Embedding SVG files</a></li>
<li><a href="#animating">Animating with anime.js</a></li>
</ol>
<p><a name="sketch"></a></p>
<h2 id="exporting-from-sketch" tabindex="-1">Exporting from Sketch</h2>
<a class="dn" href="#exporting-from-sketch"><span class="dn">Permalink to “Exporting from Sketch”</span> <span aria-hidden="true">#</span></a><p>There are two main problems.</p>
<h3 id="1.-mitigating-transforms" tabindex="-1">1. Mitigating <code>transform</code>s</h3>
<a class="dn" href="#1.-mitigating-transforms"><span class="dn">Permalink to “1. Mitigating transforms”</span> <span aria-hidden="true">#</span></a><p>Many SVG elements are positioned using <code>transform</code> attributes.</p>
<p>As far as I can tell, the animation library (anime.js) cannot apply <em>relative</em> mutations to the <code>transform</code> attribute of SVGs. In plain language, this means you can’t move stuff around. That’s a big problem because moving stuff around is kind of the essence of animating.</p>
<p>To make this work, you need to be able to produce SVG elements without any <code>transform</code> attribute. That way, anime.js can apply <em>absolute</em> changes via the <code>transform</code> attribute.</p>
<p><s>There are good things about Sketch’s SVG export. For example, if you name layers, it keeps these names as SVG <code>id</code> attributes in the export. This lets you select them with your animation library and move them. Yay.</s></p>
<blockquote>
<p><strong>Update 10/18/21:</strong> This appears to be gone or broken now, too. The latest SVG I exported from Sketch didn’t output any <code>id</code>s for groups I named.</p>
</blockquote>
<p>The bad thing about Sketch’s SVG export is that you lack control over how things get exported. So there are <code>transform</code>s on all sorts of stuff, making a bunch of stuff unusable for animation.</p>
<p>The good news is that Sketch supports plugins, and there is an <a href="https://github.com/sketch-hq/svgo-compressor">SVG plugin</a> that claims to give you control over these issues with features like:</p>
<ul>
<li><code>moveGroupAttrsToElems</code> — “Moves group attrs to the content elements.”</li>
<li><code>convertPathData</code> — “Optimizes path data: writes in shorter form, applies transformations.”</li>
</ul>
<p>The bad news is, while the plugin appears to do some things, neither of those features actually work. After applying <code>moveGroupAttrsToElems</code>, all groups (<code>&lt;g&gt;</code>) still have <code>transform</code> (and many other) attributes on them. Similarly, after applying <code>convertPathData</code>, some paths (<code>&lt;path&gt;</code>) still have <code>transform</code> attributes on them.</p>
<p>I opened an issue for <a href="https://github.com/sketch-hq/svgo-compressor/issues/79">the first problem</a>, but as there are unresolved issues on that repository that are five years old—including a <a href="https://github.com/sketch-hq/svgo-compressor/issues/20">very similar report</a> to my own that’s been closed and still broken for three years—I am not optimistic.<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup></p>
<p><strong>My current workaround is:</strong> because, after running the plugin, <em>most</em> groups have <code>transform</code>s on them, but <em>most</em> children (like paths) contained in the groups don’t, I use anime.js to select all <em>children</em> of a group, using a selector like <code>#group-id *</code>. Then, I add <code>transform</code> animations to the children directly, which give them relative motion.</p>
<h3 id="2.-converting-text-to-shapes" tabindex="-1">2. Converting text to shapes</h3>
<a class="dn" href="#2.-converting-text-to-shapes"><span class="dn">Permalink to “2. Converting text to shapes”</span> <span aria-hidden="true">#</span></a><p>Not everyone has the same fonts installed. Text in SVG, by default, simply contains the font that’s supposed to be used, and the text to render. If someone doesn’t have the font you want installed, text will not display properly.</p>
<p>Sketch has a way to convert text to outlines. This is a destructive process; once you do it, you can no longer edit the text or any of its properties (like typeface, size, weight). Obviously, this makes iterating unpleasant.</p>
<p>Sketch lacks any SVG export option to automatically convert text to shapes. This is a bummer. (It was <a href="https://sketchtalk.io/discussion/3654/automatically-convert-text-to-outlines-on-export">suggested</a> three years ago into the pointless void of product forums.)</p>
<p>One <a href="https://www.reddit.com/r/sketchapp/comments/csn0rs/converting_text_to_outlines_on_svg_export/exm71et/">workaround</a> I’ve seen is to “intersect” all text with a box of the same color as the text. As far as I can tell, this must be done separately per text color, and text must either be grouped first (or each text won’t mutually intersect and become blank) or intersected with a separate box. Doing this makes the text export as paths, but can still be edited by selecting the layer.</p>
<p>Unfortunately, the workaround, at least as I’ve implemented it, is not only tedious, but pollutes the sketch with these background objects that make selecting both the text and other content quite difficult.</p>
<p><strong>My current workaround is:</strong> to wait until my <em>final</em> draft, and convert all text to outlines then. I am also trying to start keeping little samples of non-converted text around outside the arboard area so that I know what it was in case I need to make more edits down the road.</p>
<p><a name="embedding"></a></p>
<h2 id="embedding-svg-files" tabindex="-1">Embedding SVG files</h2>
<a class="dn" href="#embedding-svg-files"><span class="dn">Permalink to “Embedding SVG files”</span> <span aria-hidden="true">#</span></a><p><s>As far as I can tell, you cannot animate an SVG file with anime.js if it’s not literally dumped inside the source HTML page.</s> This was the approach I took for the diagrams I’d made so far. Today, I finally went down the full rabbit hole to solve this issue.</p>
<p>You cannot do <code>&lt;img src=&quot;picture.svg&quot; /&gt;</code>. The image will be rendered, but the DOM won’t have all the SVG nodes, so they can’t be selected by the animation library. This one is obvious.</p>
<p>You can do <code>&lt;object data=&quot;picture.svg&quot;&gt;&lt;/object&gt;</code>, but it requires two workarounds.<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup></p>
<p>The crux of the issue is that contents of the SVG will be inserted, but anime.js won’t be able to find the SVG nodes with its element selectors. This is because the SVG is actually inside a new <code>document</code> within the <code>&lt;object&gt;</code> node.</p>
<p>The first workaround you must do is to get the <code>document</code> inside the <code>&lt;object&gt;</code> element, and explicitly query your nodes.</p>
<p>For example, if we have the object</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>object</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my-diagram<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image/svg+xml<span class="token punctuation">"</span></span> <span class="token attr-name">data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>picture.svg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>object</span><span class="token punctuation">></span></span></code></pre>
<p>… then we can get the document that gets loaded inside it with</p>
<pre class="language-js"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'my-diagram'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contentDocument</code></pre>
<p>However, if you do this immediately, or even after the <code>DOMContentLoaded</code> event fires, you will be successfully given an empty <code>document</code>. Bummer. The contents haven’t loaded yet.</p>
<p>So, instead, you can wait for it to load (thanks, as usual, to <a href="https://stackoverflow.com/a/27808044/3838962">a StackOverflow answer</a>):</p>
<pre class="language-js"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'my-diagram'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"load"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> innerDoc <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'my-diagram'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contentDocument<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p class="figcaption">I probably could have shortened this by relearning how <code>this</code> works.</p>
<p>Then, using that <code>innerDoc</code>, you can write your own query selector to send to anime.js:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// continuing the above, inside the anonymous function</span><br><span class="token function">anime</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token literal-property property">targets</span><span class="token operator">:</span> innerDoc<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"#fun-group *"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">translateX</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><br>    <span class="token operator">...</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This <em>still</em> doesn’t work. This is quite bizarre, because you can verify with Chrome’s developer tools that <code>innerDoc.querySelectorAll(&quot;#fun-group *&quot;)</code> does return a <code>NodeList</code> (well, if you have matching stuff in your SVG). And, if you run the same thing on an <code>&lt;svg&gt;</code> directly inside the page, it works.</p>
<p>And, so we are on to our second quandary: how to tell anime.js about these foreign document nodes we’ve been able to successfully query?</p>
<p>First, we enter a debugging process you can skip over.</p>
<blockquote>
<p>Aside: Debugging anime.js</p>
<ul>
<li>the <code>targets</code> appear saved correctly (as <code>animatables</code>), but the list of <code>animations</code> is empty (in <code>createNewInstance()</code>)</li>
<li><code>getAnimationType()</code> matches no <code>if</code> statement (and so returns <code>undefined</code>)
<ul>
<li>however, <code>el</code> is a <code>NodeList</code>, but it looks like the code is expecting it to be a single element</li>
<li>this makes me think that maybe the code that array-ifies the passed values is broken; the <code>NodeList</code> is passing its checks, but it shouldn’t be, because it’s not being unpacked correctly for later.</li>
</ul>
</li>
<li><code>toArray()</code> checks <code>o instanceof NodeList</code>, which fails, even though Chrome’s debugger says its a <code>NodeList</code>. So I wonder if the issue is that it’s a “foreign” <code>NodeList</code> because it’s from a different DOM? Anyway, when this check fails, <code>toArray()</code> returns <code>[o]</code>, which means we now have <code>[NodeList]</code>—in other words, an array of length 1 containing a NodeList. That seems to be wrong.</li>
<li>oooh, I totally mised it then—<code>animatables</code> above in <code>createNewInstance()</code> was actually an <code>[NodeList]</code> (array with the <code>NodeList</code> as a single element). Or maybe I saw this and assumed it was OK because <code>animatables</code> is plural and I thought maybe there could have been multiple selectors? Either way.</li>
<li>I think the root of this might be the <code>o instanceof NodeList</code> check. I might try to experiment with this using the raw selection.</li>
<li>Yeah, right when I get the elements, <code>els instanceof NodeList</code> fails. I suspect fundamentally solving this might require next-level DOM wizardry. Instead, the workaround in the <a href="https://github.com/juliangarnier/anime/issues/548">issue</a> I came across works: sending in the <code>NodeList</code> by spreading it first with <code>[...els]</code>.</li>
</ul>
</blockquote>
<p>The tl;dr: is that anime.js has a bug where it can’t identify the foreign <code>NodeList</code> as a <code>NodeList</code>, so it wraps it in an array, which screws up the later steps, so no animations end up being made.</p>
<p>Enter the second workaround, given by the <a href="https://github.com/juliangarnier/anime/issues/548">GitHub issue</a> that sent me further down this hole: repackaging the <code>NodeList</code> as an array, simply by spreading it out.</p>
<p>In other words:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> nodeList <span class="token operator">=</span> innerDoc<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"#fun-group *"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">anime</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token comment">// targets: nodeList, // this is what we were doing</span><br>    <span class="token literal-property property">targets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>nodeList<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// this is what works</span><br>    <span class="token literal-property property">translateX</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><br>    <span class="token operator">...</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Putting this all together:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// IDK whether this outer event listener is necessary, but I don't think</span><br><span class="token comment">// it can hurt (famous last words).</span><br>document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Wait for the SVG contents to load</span><br>    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'my-diagram'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"load"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// Grab the inner document</span><br>        <span class="token keyword">const</span> innerDoc <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'my-diagram'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contentDocument<span class="token punctuation">;</span><br>        <span class="token function">anime</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>            <span class="token comment">// Query the inner doc for the nodes, and repackage them</span><br>            <span class="token comment">// as a vanilla array.</span><br>            <span class="token literal-property property">targets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>innerDoc<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"#fun-group *"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token literal-property property">translateX</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><br>            <span class="token operator">...</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><strong>In summary, my current workarounds are:</strong> (1) wait for the <code>&lt;object&gt;</code> to load and get the nodes we want to animate ourselves, (2) unpack them to a vanilla array before sending into anime.js.</p>
<p><a name="animating"></a></p>
<h2 id="animating-with-anime.js" tabindex="-1">Animating with anime.js</h2>
<a class="dn" href="#animating-with-anime.js"><span class="dn">Permalink to “Animating with anime.js”</span> <span aria-hidden="true">#</span></a><p>I’ve run into two main issues.</p>
<h3 id="1.-cannot-apply-relative-changes-to-transforms" tabindex="-1">1. Cannot apply relative changes to <code>transform</code>s</h3>
<a class="dn" href="#1.-cannot-apply-relative-changes-to-transforms"><span class="dn">Permalink to “1. Cannot apply relative changes to transforms”</span> <span aria-hidden="true">#</span></a><p>As I mentioned above to motivate trying to clean up Sketch’s SVG exports, I do not think anime.js can apply relative changes to <code>transform</code> attributes.</p>
<p>anime.js can:</p>
<ol>
<li>
<p>Apply relative changes to scalars using strings like <code>+=10</code>, <code>-=10</code>, and <code>*=10</code>.</p>
</li>
<li>
<p>Apply full overwrites of SVG <code>transform</code> attributes by:</p>
<ol>
<li>
<p>Overwriting the <code>transform</code> attribute directly by mutating its values</p>
</li>
<li>
<p>Implicitly overwriting the <code>transform</code> attribute by adding a <code>style=&quot;transform: translateX(...) translateY(...);&quot;</code>. This will then be applied <em>instead</em> of the <code>transform</code> attribute (rather than composing them).</p>
</li>
</ol>
</li>
</ol>
<p>Unfortunately, I don’t think there is a way of combining points 1 and 2: using relative changes to mutate <code>transform</code> values.</p>
<p><strong>My current workaround is:</strong> to attempt to avoid this by trying to get SVG to output things that I want to animate that don’t have <code>transform</code> attributes at all. That way I can use point 2 above to apply fresh <code>transform</code>s to move them relative to where they start.</p>
<h3 id="2.-cannot-easily-compose-motion" tabindex="-1">2. Cannot easily compose motion</h3>
<a class="dn" href="#2.-cannot-easily-compose-motion"><span class="dn">Permalink to “2. Cannot easily compose motion”</span> <span aria-hidden="true">#</span></a><p>This may be a limitation of my own understanding. The main feature presented by anime.js for complex motion is a timeline. This works for <em>sequential</em> motion. But I do not know how to accomplish <em>concurrent</em> motion.</p>
<p>By <em>concurrent</em> motion, I simply mean: imagine that you want a circle to do two things at the same time:</p>
<ol>
<li>bob up and down</li>
<li>travel around the page</li>
</ol>
<p>This motion should be compositional: the circle travels around, bobbing up and down all the while.</p>
<p>I do not know how to easily accomplish this with anime.js.</p>
<p><strong>My current workaround is:</strong> to avoid using compositional motion.</p>
<h3 id="other-little-bugs" tabindex="-1">Other little bugs</h3>
<a class="dn" href="#other-little-bugs"><span class="dn">Permalink to “Other little bugs”</span> <span aria-hidden="true">#</span></a><p>Just keeping a note here in case they’re note part of the above (though I’m not sure).</p>
<ul>
<li>SVG rotations (can’t easily pick a center point)</li>
<li>SVG translateX/Y on Safari</li>
</ul>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>This is one of those notes that will probably be relevant to a maximum of three other people, ever, on planet earth. But if any one of those people is just starting down this path and running into these problems, I hope this saves you a massive amount of the confusion that I slogged through. <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn2" class="footnote-item"><p>For those wondering about the failings of open source, this is it: software that <em>nearly</em> works but has fallen out of maintenance.) <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn3" class="footnote-item"><p>As an aside, I don’t understand how these problems aren’t trivially solved. Why is what I’m doing a corner case? I would think that if you wanted to make animations online, the simplest content to use would be SVG. Rather than positioning everything by hand with HTML <code>&lt;div&gt;</code>s or something, you can use graphical software to draw diagrams and export them as SVG. Plus, SVG is native browser tech, and it’s vectorized so it renders nicely at different scales. Sketch is super mainstream vector software. As far as I can tell, besides a couple CSS libraries with gaudy effects, anime.js is a mainstream animation library. I’m not even tied to Sketch or anime.js, they just seem like obvious default choices for “how to make a simple animation on your website.” So, why is getting the pipeline working so hard?!? <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>

      </div>

      
      

      
      <!-- <hr /> -->
<!-- <div class="bt b--black-80 mt4"></div> -->
<div class="ba b--black-80 mt5 f6 f5-ns">
    <form style="text-align:center;" action="https://tinyletter.com/mbforbes" method="post" target="popupwindow"
        onsubmit="window.open('https://tinyletter.com/mbforbes', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
        <p class="tc b">
            Monthly project and essay digest
        </p>
        <p class="tc measure center">
            <label for="tlemail">
                I send a summary every month of my new projects and essays.
                No spam, just me, Max. Unsub whenever.
            </label>
        </p>
        <p class="mb1">
            <input type="text" style="width:200px" name="email" id="tlemail" placeholder="your email"/>
            <input type="hidden" value="1" name="embed"/><input type="submit" value="Get on the list"/>
        </p>
        <p class="mt0 f7 f6-ns">
            <!-- via -->
            <img src='/website-3/assets/img/TinyLetter_Wordmark.png' style="height: 22px;"/>
        </p>
    </form>
</div>


      
      
        <p class="tr ttu black-30 fw6 f6 f5-ns mt5 mb0">garage entry metadata</p>
<table class="mv0 collapse ba br2 b--black-10 pv2 ph3 f6 f5-ns black-50 w-100">
    <tbody id="garage-metadata">
        <tr class="striped--near-white">
            <td class="pv2 ph3 ttu fw6">
                started
            </td>
            <td class="pv2 ph3 ttu">
                31 Jul 2021
            </td>
        </tr>

        

        <tr class="striped--near-white">
            <td class="pv2 ph3 ttu fw6">
                disclaimer
            </td>
            <td class="pv2 ph3">
                This is an entry in
                
                    <a href="/website-3/garage/what-is-the-garage/" class="hover-dark-blue underline-hover">the garage</a>.
                
                It may change or disappear at any point.
            </td>
        </tr>
    </tbody>
</table>

<!-- Comments! -->
<script src="https://utteranc.es/client.js" repo="mbforbes/website-comments" issue-term="pathname" theme="github-light"
    crossorigin="anonymous" async>
    </script>

<!-- Link graph! -->
<script async>
    function addRow(name, graph, keys) {
        let links = [];
        for (let key of keys) {
            if (!(key in graph)) {
                console.warn("Skipping " + key + ", not found in link graph.")
                continue;
            }
            
            links.push(`<li><a href="${graph[key].url}" class="hover-dark-blue underline-hover">${graph[key].title}<a/></li>`);
        }
        if (links.length == 0) {
            return;
        }
        let row = document.createElement("tr");
        row.classList.add("striped--near-white");
        row.innerHTML = `
        <tr class="striped--light-gray">
            <td class="pv2 ph3 ttu fw6">
                ${name}
            </td>
            <td class="pv2 ph3 ${name}">
                <ul class="pl3 mv0">
                    ${links.join("\n")}
                </ul>
            </td>
        </tr>
        `
        document.getElementById("garage-metadata").appendChild(row);
    }

    async function renderLinks() {
        let resp = await fetch("/website-3/assets/garage/link_graph.json");
        if (!resp.ok) {
            return;
        }
        let graph = await resp.json();
        let current = "/garage/animating-svgs-from-sketch-with-anime.js/";
        if (!(current in graph)) {
            return;
        }
        addRow("inbound", graph, graph[current].incoming);
        addRow("outbound", graph, graph[current].outgoing);

    }
    renderLinks();
</script>

      
    </main>
  </div>
  <footer class="mt5 f6 f5-ns mw7 center tc pt2 pb4 silver">
    <div class="mh3 mh4-ns bt b--silver mb1"></div>
    <a href="/website-3/about/" class="link silver hover-blue pv1">
      about me
    </a>
    | orig theme is
    <a href="http://github.com/muan/scribble" class="link silver hover-blue pv1">Scribble</a>
    <!-- <img src="https://maxwellforbes.com/data/img/scribble2.png" alt="scribble" class="mt4 db center" /> -->
  </footer>

  
  <script>
    // settings
    let periods = 0.5;
    let baseDelay = 1; // s
    let charDelay = 0.1; // s
    let duration = 0.70; // s
    let startW = 400; // w
    let mag = 400; // +/- w
    let refresh = 0.016667; // s

    // computed vals
    let frames = duration / refresh;

    // state
    let updaters = [];
    let frameNs = [];

    function fontWeighter(idx) {
      frameNs[idx] += 1;
      let x = (frameNs[idx] / frames) * periods * 2 * Math.PI;
      let w = Math.round(startW + mag * Math.sin(x));
      document
        .getElementById("header")
        .children[idx]
        .style
        .fontWeight = w;
      if (frameNs[idx] >= frames) {
        clearInterval(updaters[idx]);
      }
    }

    function wave() {
      // replace the string w/ elements. i write it as a string to start because i
      // couldn't get vscode's html formatter (using one for nunjucks) to not split
      // span elements each onto their own lines, which caused spaces between each
      // letter.
      let header = document.getElementById("header");
      let name = header.innerText;
      let els = [];
      for (let i = 0; i < name.length; i++) {
        let el = document.createElement("span");
        el.innerText = name[i];
        els.push(el);
      }
      header.innerText = '';
      header.append(...els);

      for (let i = 0; i < els.length; i++) {
        frameNs.push(0);
        setTimeout(() => {
          updaters.push(setInterval(fontWeighter.bind(null, i), refresh * 1000));
        }, (baseDelay + charDelay * i) * 1000);
      }
    }

    wave();
  </script>


    </body>

</html>
